# 最短デモ（MVP）実現に向けた開発計画書（超・最小構成版）

## 1. はじめに

このドキュメントは、IR分析プロジェクトのコアバリューを早期に実証するため、UIと**分析内容を最小限**にしたデモ（Minimum Viable Product）の実現に向けた開発計画と方針を定義するものです。

## 2. 基本方針

データベースへの永続化をスコープアウトし、取得したデータをメモリ上で直接処理する方針は維持します。さらに、**既存の高度な分析モジュール (`utils/analysis.py`) を使用せず**、主要な財務項目をシンプルに表示することに特化し、開発速度を最大化します。

### この方針のメリット
- **開発速度の最大化:** DB連携と複雑な分析ロジックの両方を後回しにし、最短（約1日）でのデモ実現を目指します。
- **価値の早期検証:** 「企業データを取得し、即座に主要業績を可視化する」というプロジェクトの核心的価値を、最も早く具体的に示すことができます。

## 3. デモのシナリオ（超・最小構成版）

1.  ユーザーがStreamlitアプリケーションを開きます。
2.  画面に、あらかじめ定義された企業リストがプルダウンメニューで表示されます。
3.  ユーザーがプルダウンから分析したい企業を1社選択し、「分析実行」ボタンをクリックします。
4.  処理が実行され、選択された企業の**主要な財務項目（例: 売上高、経常利益、純利益）とその簡易的なグラフ**が画面に表示されます。

## 4. 実装タスクの見積もり

このデモを実現するための合計工数は **約1営業日** を見込んでいます。

### タスク1: データ取得機能の改修 (`utils/api.py`)

- **方針:** 特定の `docId` を1つだけ受け取り、その会社の財務データ（DataFrame）を返す、シンプルで再利用性の高い関数 `fetch_single_company_data` に改修します。
- **主な作業内容:** 既存の`fetch_financial_data`関数のロジックを整理し、ループ処理を削除します。
- **見積もり工数:** **約0.5日**

### タスク2: UIとシンプルな分析・表示ロジックの実装 (`app/app.py`)

- **方針:** `utils.analysis.py`を**使用せず**、`app/app.py`内で直接、取得したデータから主要な財務項目のみを抜粋してシンプルに表示します。
- **主な作業内容:**
  1.  **UIコンポーネントの配置:** ハードコードされた企業リストを表示するプルダウンと、分析実行ボタンを配置します。
  2.  **財務データの取得:** 分析ボタンが押されたら、**タスク1**で改修した `fetch_single_company_data` を呼び出します。
  3.  **シンプルな分析・抽出:** `pandas`を使い、取得したDataFrameから「売上高」「経常利益」「純利益」など、数個の主要項目の値を抽出します。
  4.  **結果の表示:** 抽出した数値を `st.metric` で表示し、`st.bar_chart` で簡単な棒グラフを表示します。
- **見積もり工数:** **約0.5日**

## 5. デモのスコープ（やること・やらないこと）

### やること (In Scope)
- 特定の1社の財務データをEDINETからリアルタイム取得。
- **取得データから主要数項目を抜粋し、数値を表示。**
- **主要数項目の簡易的なグラフ（棒グラフなど）を表示。**
- 上記をStreamlitの基本的なUIで操作・表示する一連の流れ。

### やらないこと (Out of Scope)
- **`utils/analysis.py` を用いた高度な財務指標（ROE, ROA等）の計算と可視化。**
- データベースへの一切のデータ保存・読み込み。
- 複数企業を横断した比較分析機能。
- 過去データとの時系列分析機能。
- ユーザー認証、エラーハンドリング、パフォーマンスチューニング等の堅牢化。

## 6. 結論

本計画に基づき開発を進めることで、**約1営業日**という極めて短い期間で、プロジェクトの核心機能を実証するデモを構築することが可能です。

---

## 7. 現在の実装状況と残タスク (2025-08-25現在)

### 実装済みの機能

- **UIと表示ロジックのモックアップ実装:**
  - `app/app.py` にて、ローカルに保存されたCSVファイルをデータソースとして、企業を選択し、主要な財務項目（売上、各利益）をグラフ表示するUIは実装済みです。
  - MVPの**最終的な見た目（UI）に近い状態**は確認できます。
- **（参考）企業リスト取得・分析関数:**
  - `utils.api.get_company_list` や `utils.analysis.py` といった、より高度な機能の部品は存在しますが、MVPでは使用しません。

### 未実装の機能（最優先残タスク）

- **データ取得ロジックの根本的な改修:**
  - **現状:** `app/app.py`は、ローカルの静的CSVファイルを参照しています。
  - **TODO:** これを**EDINET APIからの動的なリアルタイム取得**に全面的に切り替える必要があります。これがMVP達成のための最重要課題です。
- **上記に伴う具体的なタスク:**
  - **タスク1: `utils/api.py`の改修:** `fetch_financial_data`を、単一企業を対象とする`fetch_single_company_data`へと改修します。
  - **タスク2: `app/app.py`の修正:** ハードコードされたファイルパス参照を削除し、ユーザーの選択に応じて`fetch_single_company_data`を呼び出すロジックを実装します。

---

## 8. MVP後の展望（中長期的アーキテクチャ）

このMVPは、プロジェクトの核心価値を最速で検証するための**第一歩**です。
MVPの成功後、アプリケーションをより堅牢で拡張性の高いものにするため、以下の本格的なアーキテクチャへの移行を計画しています。

- **データベースの導入:**
  - 取得したデータを恒久的に保存し、時系列分析や複数企業比較を実現するため、データベース（PostgreSQLなど）を導入します。
- **3層アーキテクチャへの移行:**
  - `api_refactoring_guide.md` や `app_refactoring_guide.md` で詳述されている通り、以下の責務分離を行います。
    - **View (app.py):** UIの表示とユーザー操作の受付に専念。
    - **Service:** ビジネスロジック（データ加工や計算）を担当。
    - **Repository:** データベースとのやり取り（CRUD操作）をカプセル化。
- **SQLAlchemy ORMの全面活用:**
  - `db_and_sqlalchemy_review.md` の提案に基づき、モデル間のリレーションシップを定義し、オブジェクト指向のデータ操作を実現します。

このアーキテクチャへの移行により、機能追加や仕様変更に強く、テストのしやすい持続可能なシステムを構築することを目指します。
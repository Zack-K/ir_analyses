## MVPとして必須となる機能（2025-08-26時点）

MVP（Minimum Viable Product）として成立するために、**最低限実装すべき機能**を以下に明確化します。

### 必須機能一覧

1. **企業選択UI**
  - サイドバーで企業名またはEDINETコードを選択できること
  - 企業リストはDBまたはCSVから取得（将来的にはDB化）

2. **財務データ取得・標準化**
  - 選択企業の財務データ（売上高、営業利益、経常利益、純利益）を取得
  - データはCSVまたはDBから取得し、DataFrameとして標準化

3. **主要財務指標の表示**
  - 売上高、営業利益、経常利益、純利益の数値を画面に表示
  - 各種利益率（営業利益率、経常利益率、売上高純利益率）を算出し、グラフで比較表示
  - グラフの表示順は「営業利益率」「経常利益率」「売上高純利益率」とする

4. **シンプルなUI/UX**
  - 2カラムレイアウトで主要指標を分かりやすく表示
  - 企業情報・提出日などの基本情報も表示

5. **データ表示の柔軟性**
  - DataFrameの表示/非表示を切り替え可能（チェックボックス）

---

この機能群を実装することで、IR分析プロジェクトのMVPとして十分な価値をユーザーに提供できます。
# 最短デモ（MVP）実現に向けた開発計画書（超・最小構成版）

## 1. はじめに

このドキュメントは、IR分析プロジェクトのコアバリューを早期に実証するため、UIと**分析内容を最小限**にしたデモ（Minimum Viable Product）の実現に向けた開発計画と方針を定義するものです。

## 2. 基本方針

データベースへの永続化をスコープアウトし、取得したデータをメモリ上で直接処理する方針は維持します。さらに、**既存の高度な分析モジュール (`utils/analysis.py`) を使用せず**、主要な財務項目をシンプルに表示することに特化し、開発速度を最大化します。

### この方針のメリット
- **開発速度の最大化:** DB連携と複雑な分析ロジックの両方を後回しにし、最短（約1日）でのデモ実現を目指します。


# 1. IR分析プロジェクト MVP開発計画書

---

## 1.1. はじめに

このドキュメントは、IR分析プロジェクトのコアバリューを早期に実証するため、UIと分析内容を最小限にしたデモ（Minimum Viable Product）の実現に向けた設計方針と開発計画を定義します。

---

## 2. 基本方針

2.1. データベースへの永続化は初期スコープ外とし、取得データはメモリ上で直接処理
2.2. 既存の高度な分析モジュール（`utils/analysis.py`）は使用せず、主要財務項目のシンプルな表示に特化
2.3. 開発速度を最大化し、最短（約1営業日）でのデモ実現を目指す

**メリット**
2.4. 複雑な分析ロジックやDB連携を後回しにできるため、早期に価値検証が可能

---

## 3. 技術アーキテクチャ

3.1. **3層構造（View/Controller, Service, Repository）**を採用
  - `app.py`（Streamlit UI）はServiceレイヤーのみを呼び出し、DBやORMには直接触れない
  - ServiceレイヤーはビジネスロジックとDTO/DataFrame変換を担当
  - RepositoryレイヤーはSQLAlchemy ORMを使ったDBアクセスに特化

---

## 4. MVPとして必須となる機能（2025-08-26時点）

### 4.1. 必須機能一覧

4.1.1. **企業選択UI**
  - サイドバーで企業名またはEDINETコードを選択できること
  - 企業リストはDBまたはCSVから取得（将来的にはDB化）

4.1.2. **財務データ取得・標準化**
  - 選択企業の財務データ（売上高、営業利益、経常利益、純利益）を取得
  - データはCSVまたはDBから取得し、DataFrameとして標準化

4.1.3. **主要財務指標の表示**
  - 売上高、営業利益、経常利益、純利益の数値を画面に表示
  - 各種利益率（営業利益率、経常利益率、売上高純利益率）を算出し、グラフで比較表示
  - グラフの表示順は「営業利益率」「経常利益率」「売上高純利益率」とする

4.1.4. **シンプルなUI/UX**
  - 2カラムレイアウトで主要指標を分かりやすく表示
  - 企業情報・提出日などの基本情報も表示

4.1.5. **データ表示の柔軟性**
  - DataFrameの表示/非表示を切り替え可能（チェックボックス）

---

## 5. MVPで実装する機能

5.1. 企業データの可視化（Streamlit）

- サイドバーで企業選択（EDINETコード or 企業名）
- 選択企業の財務サマリー（売上高、営業利益、経常利益、純利益、利益率）をグラフ表示
  - 利益率グラフは「営業利益率」「経常利益率」「売上高純利益率」の順で表示
  - グラフ表示順は`CategoricalIndex`で明示的に制御

5.2. データ取得・永続化

- CSV/XBRLからデータを読み込み、標準化
- DataFrameからSQLAlchemyモデルオブジェクトへのマッピング（`api.py`の責務）
- Serviceレイヤー経由でDBに保存（Upsert対応、トランザクション管理）

5.3. DBからのデータ取得

- Serviceレイヤーで企業ID/EDINETコードを受け取り、Repositoryから必要な財務データを取得
- ServiceレイヤーでDataFrame/DTOに変換し、UIに返却

---

## 6. コード設計・リファクタリング

6.1. `db_models.py`：モデル間の`relationship`と`index`を追加
6.2. `db_controller.py`：廃止し、各モデルごとにRepositoryクラスを新設
6.3. `api.py`：マッピング処理に集中し、永続化はService/Repositoryに委譲
6.4. テスト：Repository単位でモデルオブジェクトのプロパティを直接検証。テストごとにトランザクションをロールバック

---

## 7. 実装優先度

7.1. DBモデルの強化（`relationship`/`index`追加）
7.2. Repositoryクラスの新設とUpsert/トランザクション管理
7.3. Serviceレイヤーの新設とDTO/DataFrame変換
7.4. `app.py`のUIロジックのService呼び出し化
7.5. テストの刷新

---

## 8. ゴール

8.1. DBとStreamlit間の疎結合・高保守性な連携
8.2. 企業財務データのグラフ可視化（利益率順序制御含む）
8.3. 拡張性・テスト容易性の高い設計

---

## 9. デモのシナリオ（超・最小構成版）

9.1. ユーザーがStreamlitアプリケーションを開く
9.2. 画面に、あらかじめ定義された企業リストがプルダウンメニューで表示される
9.3. ユーザーがプルダウンから分析したい企業を1社選択し、「分析実行」ボタンをクリック
9.4. 処理が実行され、選択された企業の主要な財務項目（売上高、経常利益、純利益）とその簡易的なグラフが画面に表示される

---

## 10. 実装タスクの見積もり

10.1. データ取得機能の改修（`utils/api.py`）：約0.5日
10.2. UIとシンプルな分析・表示ロジックの実装（`app/app.py`）：約0.5日
10.3. 合計工数：約1営業日

---

## 11. デモのスコープ（やること・やらないこと）

11.1. やること (In Scope)
- 特定の1社の財務データをEDINETからリアルタイム取得
- 取得データから主要数項目を抜粋し、数値を表示
- 主要数項目の簡易的なグラフ（棒グラフなど）を表示
- 上記をStreamlitの基本的なUIで操作・表示する一連の流れ

11.2. やらないこと (Out of Scope)
- `utils/analysis.py` を用いた高度な財務指標（ROE, ROA等）の計算と可視化
- データベースへの一切のデータ保存・読み込み
- 複数企業を横断した比較分析機能
- 過去データとの時系列分析機能
- ユーザー認証、エラーハンドリング、パフォーマンスチューニング等の堅牢化

---

## 12. 現在の実装状況と今後のタスク（2025-08-26現在）

12.1. 実装済みの機能

- Streamlitアプリケーションの基本設定
  - `app/app.py` にて、アプリケーションの起動、画面レイアウト（2カラム分割）、企業情報・提出日表示が実装済み
- 企業選択・データ取得
  - サイドバーで企業名を選択し、CSVファイルから財務データを取得・標準化
- 主要財務データの表示
  - 売上高、営業利益、経常利益、純利益の推移をグラフ化
  - 各種利益率（営業利益率、経常利益率、売上高純利益率）の算出・比較グラフ（順序制御済み）
  - DataFrameの任意表示（チェックボックス）

12.2. これから取り組むべき機能（残タスク）

12.2.1. **DB連携・永続化**
  - 企業リストや財務データをDBから取得する仕組み（現状はCSV直読）
  - DB保存・更新（Upsert）機能の追加
  - SQLAlchemyモデル・Repositoryクラスの設計

12.2.2. **Serviceレイヤーの導入**
  - UI（Streamlit）から直接API/DBにアクセスせず、Service経由でデータ取得・変換
  - DTO/DataFrame変換の責務分離

12.2.3. **企業選択の拡張**
  - EDINETコードや企業名での検索・絞り込み
  - サイドバーの企業リストをDBから動的取得

12.2.4. **分析機能の拡充**
  - 期間選択（四半期・年度など）のUI追加
  - 追加財務指標（キャッシュフロー、自己資本比率など）のグラフ化
  - 複数企業の比較表示

12.2.5. **テスト・保守性向上**
  - 各レイヤー（Repository/Service/UI）の単体テスト
  - トランザクション管理・例外処理の強化

12.2.6. **設定・運用面**
  - 設定ファイルの環境自動切替（Docker/ローカル）
  - バッチ実行・スケジュール化対応

---

## 13. 結論

13.1. 本計画に基づき開発を進めることで、約1営業日という短期間でプロジェクトの核心機能を実証するデモを構築可能です。
13.2. 今後は「DB連携」「Serviceレイヤー導入」「企業選択の拡張」「分析機能の拡充」「テスト・運用面の強化」を優先的に進めてください。

---

## 3. デモのシナリオ（超・最小構成版）

1.  ユーザーがStreamlitアプリケーションを開きます。
2.  画面に、あらかじめ定義された企業リストがプルダウンメニューで表示されます。
3.  ユーザーがプルダウンから分析したい企業を1社選択し、「分析実行」ボタンをクリックします。
4.  処理が実行され、選択された企業の**主要な財務項目（例: 売上高、経常利益、純利益）とその簡易的なグラフ**が画面に表示されます。

## 4. 実装タスクの見積もり

このデモを実現するための合計工数は **約1営業日** を見込んでいます。

### タスク1: データ取得機能の改修 (`utils/api.py`)

- **方針:** 特定の `docId` を1つだけ受け取り、その会社の財務データ（DataFrame）を返す、シンプルで再利用性の高い関数 `fetch_single_company_data` に改修します。
- **主な作業内容:** 既存の`fetch_financial_data`関数のロジックを整理し、ループ処理を削除します。
- **見積もり工数:** **約0.5日**

### タスク2: UIとシンプルな分析・表示ロジックの実装 (`app/app.py`)

- **方針:** `utils.analysis.py`を**使用せず**、`app/app.py`内で直接、取得したデータから主要な財務項目のみを抜粋してシンプルに表示します。
- **主な作業内容:**
  1.  **UIコンポーネントの配置:** ハードコードされた企業リストを表示するプルダウンと、分析実行ボタンを配置します。
  2.  **財務データの取得:** 分析ボタンが押されたら、**タスク1**で改修した `fetch_single_company_data` を呼び出します。
  3.  **シンプルな分析・抽出:** `pandas`を使い、取得したDataFrameから「売上高」「経常利益」「純利益」など、数個の主要項目の値を抽出します。
  4.  **結果の表示:** 抽出した数値を `st.metric` で表示し、`st.bar_chart` で簡単な棒グラフを表示します。
- **見積もり工数:** **約0.5日**

## 5. デモのスコープ（やること・やらないこと）

### やること (In Scope)
- 特定の1社の財務データをEDINETからリアルタイム取得。
- **取得データから主要数項目を抜粋し、数値を表示。**
- **主要数項目の簡易的なグラフ（棒グラフなど）を表示。**
- 上記をStreamlitの基本的なUIで操作・表示する一連の流れ。

### やらないこと (Out of Scope)
- **`utils/analysis.py` を用いた高度な財務指標（ROE, ROA等）の計算と可視化。**
- データベースへの一切のデータ保存・読み込み。
- 複数企業を横断した比較分析機能。
- 過去データとの時系列分析機能。
- ユーザー認証、エラーハンドリング、パフォーマンスチューニング等の堅牢化。

## 6. 結論

本計画に基づき開発を進めることで、**約1営業日**という極めて短い期間で、プロジェクトの核心機能を実証するデモを構築することが可能です。

---


## 7. 現在の実装状況と今後のタスク (2025-08-26現在)

### 実装済みの機能

- **Streamlitアプリケーションの基本設定:**
  - `app/app.py` にて、アプリケーションの起動、画面レイアウト（2カラム分割）、企業情報・提出日表示が実装済み。
- **企業選択・データ取得:**
  - サイドバーで企業名を選択し、CSVファイルから財務データを取得・標準化。
- **主要財務データの表示:**
  - 売上高、営業利益、経常利益、純利益の推移をグラフ化。
  - 各種利益率（営業利益率、経常利益率、売上高純利益率）の算出・比較グラフ（順序制御済み）。
  - DataFrameの任意表示（チェックボックス）。

### これから取り組むべき機能（残タスク）

1. **DB連携・永続化**
  - 企業リストや財務データをDBから取得する仕組み（現状はCSV直読）
  - DB保存・更新（Upsert）機能の追加
  - SQLAlchemyモデル・Repositoryクラスの設計

2. **Serviceレイヤーの導入**
  - UI（Streamlit）から直接API/DBにアクセスせず、Service経由でデータ取得・変換
  - DTO/DataFrame変換の責務分離

3. **企業選択の拡張**
  - EDINETコードや企業名での検索・絞り込み
  - サイドバーの企業リストをDBから動的取得

4. **分析機能の拡充**
  - 期間選択（四半期・年度など）のUI追加
  - 追加財務指標（キャッシュフロー、自己資本比率など）のグラフ化
  - 複数企業の比較表示

5. **テスト・保守性向上**
  - 各レイヤー（Repository/Service/UI）の単体テスト
  - トランザクション管理・例外処理の強化

6. **設定・運用面**
  - 設定ファイルの環境自動切替（Docker/ローカル）
  - バッチ実行・スケジュール化対応

---

現状の実装内容を踏まえ、今後は「DB連携」「Serviceレイヤー導入」「企業選択の拡張」「分析機能の拡充」「テスト・運用面の強化」を優先的に進めてください。